<!DOCTYPE html>
<head>
	<meta charset="utf-8">
  
  	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" rel='stylesheet'>
	<link href="css/style.css" rel='stylesheet'>
  <!-- Roboto & Asar CSS -->
	<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link href="https://fonts.googleapis.com/css?family=Asar" rel="stylesheet">
	
	
</head>
<body>
<img src="img/logo2.png" class="img-responsive" id="logo"/>

<div class="verticalscroll"> 

  <div id="container">
	<div id="background">
    	<img src="img/header.jpg" class="stretch" alt="" />
	</div>
    <div id="content">
	<div class="panel">

      		<h1>CYCLES OF DESTRUCTION:</h1>
       		<h2>Unsustainability, Illegality, <br>and Violence in the<span class="red"> Hongmu Trade</span> </h2><br>
       		
     </div> 
     <div class="panel">  
    	 <h1 id="top"> What is Hongmu?</h1>		
	        <p>Meaning <span class='red'>red wood</span> in Chinese, the term <span class='red'>Hongmu</span> refers to a range of richly hued durable tropical hardwoods used to produce high-end reproduction furniture, flooring and handicrafts.</p><br>
	     <h1> Recent Trends</h1>
	        <p>In recent years, China’s growing middle class has driven up demand, resulting in the sector reaching industrial scales. Rapid growth has created a <span class='red'>poorly structured market with little regulation</span>. Demand for hongmu in China has grown exponentially over the past 15 years.</p>
    </div>
    <div class="panel">
    	
    	<h1> How bad is it? </h1>
     
       <h2 class="stats"><span class='red'>During the first half of 2016, China imported on average 350 hongmu logs per hour</span> </h2>
	    
        	<img src="img/square1_450.jpg" class="img-responsive"/>
    
       <h2 class="stats"><span class='orange'> Hongmu log imports into China have increased by 1300% from 2009 to 2014</span> </h2>
           <img src="img/square2_450.jpg" class="img-responsive"/>
       <h2 class="stats"><span class='red'> China’s hongmu industry is composed of 30000 companies</span> </h2>
           <img src="img/square3_450.jpg" class="img-responsive"/>
       <h2 class="stats"><span class='orange'> The generated domestic retail revenues are over 25 billion USD</span> </h2>
      </div>
      <div class="panel">
        <h1> Are Hongmu Species Protected? </h1>
        <p> China's National Hongmu Standard identifies 33 species across the <i>Pterocarpus</i>, <i>Diospyros</i>, <i>Dalbergia</i>, <i>Millettia</i> and <i>Cassia</i> genera as recognised Hongmu species.  Only  <span class='red'>8 out of 33</span> Hongmu species are protected under CITES.</p>
      </div>
      <div class="panel">
        <h1> Demand and Transit Countries </h1><br>
	    <p  class="section">Because most hongmu species are not protected under CITES, and because the main demand side country, <span class='red'>China</span>, and key trade and processing hub <span class='red'>Vietnam</span>, do not prohibit the import of illegally harvested and/or traded timber, illegal wood from these species is legally placed in the markets there everyday.</p> 
	    <img src="img/consumers_450.jpg" class="img-responsive"/> 
	    <br>
	    <img src="img/demand_450.jpg" class="img-responsive"/>
	    <br>
	    <img src="img/vietnam_450.jpg" class="img-responsive"/>	
      </div>
      <div class="panel">
      	
        <h1> Source Countries </h1>
        <button type="button" class="btn btn-primary section" id="bubblebar">See Bar Chart</button>
         <p>The expanding hongmu trade has driven successive <span class='red'>boom and bust cycles</span>, characterized by steep rises in harvest and export volumes from individual countries before a sudden collapse, or “bust.” The fall corresponds to the rapid relocation of trading networks from one country to the next, following the exhaustion of the species, discovery of a new supply, or to avoid new control measures put in place by besieged governments.</p>
         <p>Traditionally, Southeast Asia and India were the main sources, but in recent years Africa and to some degree Latin America have become increasingly important sources. Nearly half of the world's countries, <span class="red">88 in total</span>, across <span class="red">five continents</span> have been targeted by traders since 2000.</p>
	   	 <h2> Crime </h2>
	   	 <p>Crime is a glaring characteristic of the global Hongmu trade. The trade is marked by unsustainable harvest, multiple legal violations including theft, smuggling and corruption, and violence in source countries.</p>
	   	 <p> The increasing value of the limited key species targeted has attracted  <span class='red'>criminal syndicates</span>,  <span class='red'>illegal loggers</span> and  <span class='red'>corrupt officials</span> alike. Since the sector boomed in 2009/10, a wave of hot investment capital has driven a surge of systematic illegal harvesting and timber smuggling in source countries throughout Asia, Africa and Latin America.</p>
	   </div>
	   <div class="panel">
			<h1>Africa</h1>
			<p class="section">Hongmu exports from West Africa have grown more than 1,000 fold between 2010 and 2015. West Africa is now the <span class='red'>world's leading hongmu-producing region</span> by volume.</p>
			<div class="button">
				<button type="button" id="stepBackwardAf" class="item">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
				</button>
				<div id="yearLabelAf" class="item">2009</div>
				<button type="button" id="stepForwardAf" class="item">
					<i class="fa fa-arrow-right" aria-hidden="true"></i>
				</button>
			</div>
			<p class="orange">Sequence through the years to see the change in import volume between 2009 and 2017 from West African countries.</p>
			<img src="img/africa_450.jpg" class="img-responsive"/>
			<h2> Regional Negative Impacts </h2>
			
			<p>The main species is <i>Pterocarpus erinaceus</i>, known as <span class='red'>Kosso</span>, found in the dry forests of West Africa, where the unsustainable harvest increases the risk of <span class='red'>desertification</span>. </p>
			<p>In West Africa, Hongmu species are increasingly known as <span class='red'>blood timbers</span> due to connections between illegal Hongmu trade and rebel uprisings. For example, in Senegal's Casamance region, the rosewood trade has fueled <span class='red'>rebel activities</span> through the smuggling of Kosso to neighboring Gambia.</p>
			
			</div>
	    <div class="panel">
	    	<h1>Asia</h1>
			<p class="section">Asia is the epicentre of the global Hongmu trade. It incorporates the two main demand countries and contains nearly two-thirds of the species identified in China’s Hongmu Standard</p>
			<p>With the commercial extinction of  <span class='red'>Huang Hua Li </span><i>Dalbergia odorifera</i> in China and heavy restrictions placed on the harvest and export of CITES-listed  <span class='red'>Red Sandalwood</span> <i>Pterocarpus santialinus</i> in India,  <span class='red'>Siamese Rosewood</span> <i>Dalbergia cochinchinensis</i> became the most sought-after hongmu species globally. Siamese Rosewood was belatedly listed on Appendix II in 2013 and is virtually commercially extinct, but extensive smuggling continues. </p>
			<div class="button">
				<button type="button" id="stepBackwardAs" class="item">
					<i class="fa fa-arrow-left" aria-hidden="true"></i>
				</button>
				<div id="yearLabelAs" class="item">2009</div>
				<button type="button" id="stepForwardAs" class="item">
					<i class="fa fa-arrow-right" aria-hidden="true"></i>
				</button>
			</div>
			<p class="orange">Sequence through the years to see the change in import volume between 2009 and 2017 from Southeast Asian countries.</p>
			<p> Now the main Southeast Asian hongmu species targeted are <span class='red'>Padauk</span> <i>Pterocarpus macrocarpus/pedatus</i>, and <span class='red'>Burmese Rosewood</span><i>Dalbergia oliveri/ bariensis</i>, with Laos and Myanmar providing most of the
	supply. Both species urgently need CITES protection. </p>
			<h2>Regional Negative Impacts</h2>
			<p>All Hongmu source countries in the Mekong region have strict log export bans and trade in a number of the more threatened species is completely
	prohibited. Despite these provisions, illegal cross-border log and sawn timber trade is clearly evident across the Mekong.</p>
		</div>
		<div class="panel">
	    <h1>Latin America</h1>
	    <p class="section"> Although the reported volume from Central America is relatively small, the region has <i>Dalbergia</i> species with very limited distributions that are particularly vulnerable to commercial extinction.</p>
      	<div class="button">
			<button type="button" id="stepBackwardLa" class="item">
				<i class="fa fa-arrow-left" aria-hidden="true"></i>
			</button>
			<div id="yearLabelLa" class="item">2009</div>
			<button type="button" id="stepForwardLa" class="item">
				<i class="fa fa-arrow-right" aria-hidden="true"></i>
			</button>
		</div>
		<p class="orange">Sequence through the years to see the change in import volume between 2009 and 2017 from Central American countries.</p>
		
      </div>
       <div class="panel">
        <h1> A Threat To Fragile Ecosystems </h1>
        <h2> Extinction </h2>
        <p> Myanmar provides a startling example – based on estimates of standing stocks for <i>Pterocarpus macrocarpus</i> and <i>Dalbergia oliveri</i> and current trade levels, both species are predicted to become commercially extinct within the next <span class='red'>three to 13 years</span>.</p>
      	<h2> Desertification </h2>
      	<p> Overexploitation for the Hongmu trade is being keenly felt throughout west Africa too, where the harvesting of <i>Pterocarpus erinaceus</i> from vulnerable <span class='red'>savannah ecosystems</span> is increasing the risk of <span class='red'>desertification</span>, and depriving local communities of a resource traditionally used for fuel, construction, musical instruments, traditional medicine and animal fodder.</p>
     	<h2> Habitat Degradation </h2>
     	<p>The rosewood trade is directly degrading Madagascar’s unique tropical forest ecosystems. Despite logging bans, a complete embargo on exports and CITES listings, illegal logging and smuggling of <i>Dalbergia</i> and <i>Diospyros</i> trees is causing broader ecosystems disturbances in Madagascar.
     	Logging gangs often poach endangered wildlife, including the island’s famous lemurs, for either subsistence while in the forest or sale in wildlife markets. For every rosewood log harvested, numerous lighter weight trees are used to float log rafts out of the forest.  </p>
      </div>
      <div class="panel">
        <h1> Proposed Solutions </h1>
        <p>1. Amend the annotation for the Appendix II listing for <i>Dalbergia cochinchinensis</i> to cover all parts
and derivatives commonly found in trade<br>2. Include 13 timber species of genus <i>Dalbergia</i>, native to Mexico and Central America, in Appendix II <br>3. List all <i>Dalbergia</i> species under Appendix II <br>4. List four species of the genus <i>Gibourtia</i> under Appendix II to prevent misdeclaration of hongmu species <br>5. Transfer <i>Pterocarpus erinaceus</i> from
Appendix III to Appendix II.</p>
      </div>
    </div>
 
   <div id="sticky"></div>
   
</div>
<div class="horizontalscroll">
</div>
   
   <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
	
	<!-- D3.geo -->
    <script src="https://d3js.org/d3.geo.projection.v0.min.js"></script>
    
    <!-- D3 legend -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.10.0/d3-legend.js'></script>
    
	<!-- jQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	
	<script src="bar.js"></script>
	
	<script src="data/countries.js"></script>
	<script src="data/countries2.js"></script>
  <script>
    
  // get all sections height from top and store in array
  // once a section is scrolled to, the index is updated, and certain viz are associated with certain index
  //https://stackoverflow.com/questions/21561480/trigger-event-when-user-scroll-to-specific-element-with-jquery

window.onload = function(){

  var AfricaYear = '2009';
  var AsiaYear = '2009';
  var LatinYear = '2009';

  var topArray = [];
  $(".section").each(function () {
  		var hT = $(this).offset().top;
  		var hH = $(this).outerHeight();
  		var wH = $(window).height();
  		topArray.push(hT+hH-wH);
  });
  
  
  $('#bubblebar').click(function(){
  				clicked();
   });

   //console.log(window.innerWidth);

	// set up svg and scrolling
    var width = window.innerWidth / 2
    var height = window.innerHeight
    var translate = 'translate(' + (width / 2) + ',' + (height / 2) + ')'
    
    var svg = d3.select("#sticky").append("svg")
    	.attr('width', width)
    	.attr('height', height);
    	
    var currentScrollTop = d3.select('#currentScrollTop')
     
    var body = d3.select('body').node()
    var container = d3.select('#container')
    var content = d3.select('#content')
    
    var SCROLL_LENGTH = content.node().getBoundingClientRect().height - height
       
    var scrollTop = 0
    var newScrollTop = 0
    
	container.on("scroll.scroller", function() {
      		newScrollTop = container.node().scrollTop
	    });

    var setDimensions = function() {
      width = window.innerWidth / 2
			height = window.innerHeight
      SCROLL_LENGTH = content.node().getBoundingClientRect().height - height
    }
    
    var render = function() {
      if (scrollTop !== newScrollTop) {
        scrollTop = newScrollTop
        
        console.log(scrollTop);
        console.log(topArray);
        
        if (scrollTop < topArray[0]){
        	d3.selectAll(".title").transition().duration(100).style('opacity',1);
        }
        
	   if (scrollTop > topArray[0]){
	   		 d3.selectAll(".title").transition().duration(100).style('opacity',0);
			 d3.selectAll(".stat1").transition().duration(100).style('opacity',0);
		     d3.selectAll(".axis.linechart").transition().duration(100).style('opacity',0);
		     d3.selectAll(".horizontalGrid").transition().duration(100).style('opacity',0);
		     d3.selectAll("path.line").transition().duration(100).style('opacity',0);
		     d3.selectAll("path.china").transition().duration(100).style('opacity',1);
		     d3.selectAll("path.bgcountrieschina").transition().duration(100).style('opacity',1);    
		    
	   }else{
	   		d3.selectAll(".axis.linechart").transition().duration(100).style('opacity',1);
		    d3.selectAll(".horizontalGrid").transition().duration(100).style('opacity',1);
		    d3.selectAll("path.china").transition().duration(100).style('opacity',0);
		    d3.selectAll("path.bgcountrieschina").transition().duration(100).style('opacity',0);
		    d3.selectAll("path.line").style('opacity',1); 
	   }	   
	   
	    if (scrollTop > topArray[1]){
	    	d3.selectAll("path.china").transition().duration(0).style('opacity',0);
		    d3.selectAll("path.bgcountrieschina").transition().duration(0).style('opacity',0);
			// d3.selectAll("path.worldcountries").transition().duration(100).style('opacity',1);
// 			d3.selectAll(".bubble").transition().duration(100).style('opacity',0.7);
			
			if(bubbleMapState=='bar'){
				d3.selectAll(".bubblebar").transition().duration(0).style("opacity",1);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(0)
					.style('opacity',1);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(0)
					.style('opacity',1);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(0)
					.style('opacity',1);
					
				d3.selectAll(".worldcountries")
					.transition()
					.duration(0)
					.style('opacity',0);
					
				d3.selectAll(".bubble")
				.transition()
					.duration(0)
					.style('opacity',0);

 				
			}else{
				d3.selectAll(".bubblebar")
				.transition()
				.duration(0)
				.style("opacity",0);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(0)
					.style('opacity',0);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(0)
					.style('opacity',0);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(0)
					.style('opacity',0);
					
				d3.selectAll(".worldcountries")
					.transition()
					.duration(0)
					.style('opacity',1);
					
				d3.selectAll(".bubble")
				.transition()
					.duration(0)
					.style('opacity',0.7);
			};	
			
			
	    	
	    }else{
	    	d3.selectAll("path.worldcountries").transition().duration(100).style('opacity',0);
			d3.selectAll(".bubble").transition().duration(100).style('opacity',0);
			d3.selectAll(".bubblebar")
				.transition()
				.duration(0)
				.style("opacity",0);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(0)
					.style('opacity',0);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(0)
					.style('opacity',0);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(0)
					.style('opacity',0);
	    	
	    }
	    
	    
	    if(scrollTop > topArray[2]){
	    	
	    	d3.selectAll("path.worldcountries").transition().duration(100).style('opacity',0);
			d3.selectAll(".bubble").transition().duration(100).style('opacity',0);
			d3.selectAll(".bubblebar")
				.transition()
				.duration(0)
				.style("opacity",0);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(0)
					.style('opacity',0);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(0)
					.style('opacity',0);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(0)
					.style('opacity',0);
	    	d3.selectAll("path.africancountries").transition().duration(100).style('opacity',1);
		    d3.selectAll("path.bgcountries").transition().duration(100).style('opacity',1);
		    d3.selectAll(".wafricatext").transition().duration(100).style('opacity',1);
		    d3.selectAll(".legendMapAfrica").transition().duration(100).style('opacity',1);
		    d3.selectAll("#bars").transition().duration(100).style('opacity',1);
		    		
		    d3.csv("data/africa_new.csv", function(error, data) {
				chart.year(AfricaYear);
				d3.select("#bars")
						.datum(data)
						.call(chart);
			})
	    	
	    	
	    }else{
	    	d3.selectAll("path.africancountries").transition().duration(100).style('opacity',0);
		    d3.selectAll("path.bgcountries").transition().duration(100).style('opacity',0);
		    d3.selectAll(".wafricatext").transition().duration(100).style('opacity',0);
		    d3.selectAll(".legendMapAfrica").transition().duration(100).style('opacity',0);
		    d3.selectAll("#bars").transition().duration(100).style('opacity',0);
	    }
	    
	    
	    if (scrollTop > topArray[3]){
		    	
		       d3.selectAll("path.africancountries").transition().duration(100).style('opacity',0);
		       d3.selectAll("path.bgcountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		       d3.selectAll(".wafricatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    	d3.selectAll(".legendMapAfrica").transition().duration(100).style('opacity',0);
		    	d3.selectAll("#bars")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		       d3.selectAll("#bars2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	d3.csv("data/asia_new.csv", function(error, data) {
				chart2.year(AsiaYear);
				d3.select("#bars2")
						.datum(data)
						.call(chart2);
				})
		    		
		       d3.selectAll("path.asiancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		       d3.selectAll("path.bgcountries2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		       d3.selectAll(".seasiatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		       d3.selectAll(".legendMapAsia").transition().duration(100).style('opacity',1);
	    	
	    }else{
	    	
	    	d3.selectAll("#bars2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
	    	
	    	d3.selectAll("path.asiancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		       d3.selectAll("path.bgcountries2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		       d3.selectAll(".seasiatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    d3.selectAll(".legendMapAsia").transition().duration(100).style('opacity',0);
	    }
	    
	    if (scrollTop > topArray[4]){	
	    	   d3.selectAll(".legendMapAsia").transition().duration(100).style('opacity',0);
	    	   d3.selectAll("#bars2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		       d3.selectAll("path.asiancountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		       d3.selectAll("path.bgcountries2")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		       d3.selectAll(".seasiatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		    	d3.selectAll("#bars3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	d3.selectAll(".legendMapLatin").transition().duration(100).style('opacity',1);
		    	d3.csv("data/latin_new.csv", function(error, data) {
				chart3.year(LatinYear);
				d3.select("#bars3")
						.datum(data)
						.call(chart3);
				})
		    		
		    	d3.selectAll("path.latincountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    		
		    	d3.selectAll("path.bgcountries3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
		    	
		    	d3.selectAll(".latinamericatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',1);
	    	
	    }else{
		        d3.selectAll("path.latincountries")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		    	d3.selectAll("path.bgcountries3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    		
		        d3.selectAll(".latinamericatext")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
		    	d3.selectAll(".legendMapLatin").transition().duration(100).style('opacity',0);
		    	d3.selectAll("#bars3")
		    		.transition()
		    		.duration(100)
		    		.style('opacity',0);
	    }
 
      }   
      window.requestAnimationFrame(render)
    }
    window.requestAnimationFrame(render)
    
    window.onresize = setDimensions

var textGroup = svg.append('g'); // add texts
  		
  		// section 0, doesn't count as it is called on load    
		createLine(svg);		
  		
  		textGroup.append("text")
  		.attr("class", "title")
  		.style("font-size","40px")
  		.attr("x", (width / 4))
  		.attr("y", (height / 2)-50)
  		.text("China's Hongmu Trade ");


createWorldMap(svg);

//section 1
createChinaMap(svg);

//section 2
createAfricaMap(svg);

//section 3
createAsiaMap(svg);

//section 4
createAmericaMap(svg);

//line graph

function createLine(svg){
		
		var newHeight = height - 100;
		var newWidth = width - 100;

		var x = d3.scale.linear()
			    .range([0, newWidth]);
			
		var y = d3.scale.linear()
		    .range([newHeight, 50]);

		var color = d3.scale.category10();
		
		var xAxis = d3.svg.axis()
		    .scale(x)
		    .ticks(5)
		    .orient("bottom")
		    .tickFormat(d3.format("d"));
		
		var yAxis = d3.svg.axis()
		    .scale(y)
		    .ticks(5)
		    .orient("left");
		
		var line = d3.svg.line()
		    .interpolate("basis")
		    .x(function(d) { return x(d.Year); })
		    .y(function(d) { return y(d.price); });
  		
  	
  		d3.csv("data/import_fake.csv", function(error, data) {
	  		  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Year"; }));
	
			  data.forEach(function(d) {
			    /* d.Year =+d.Year; */
			    d.All =+d.All;
			    d.Asia =+d.Asia;
			    d.LatinAmerica =+d.LatinAmerica;
			    d.Africa =+d.Africa;
			    d.Other =+d.Other;
			  });
			
			  var continents = color.domain().map(function(name) {
			    return {
			      name: name,
			      values: data.map(function(d) {
			        return {Year: d.Year, price: +d[name]};
			      })
			    };
			   });

			  
			  x.domain(d3.extent(data, function(d) { return d.Year; }));
	
			  	
			  y.domain([
			    d3.min(continents, function(c) { return d3.min(c.values, function(v) { return v.price; }); }),
			    d3.max(continents, function(c) { return d3.max(c.values, function(v) { return v.price; }); })
			  ]);
			  
			  svg.append("g")
			      .attr("class", "x axis linechart")
			      .attr("transform", "translate(80," + newHeight + ")")
			      .call(xAxis)
			      .append("text")
					  .attr("class", "label")
					  .attr("x", newWidth)
					  .attr("y", -6)
					  .style("text-anchor", "end")
					  .text("year");
					  
			  
			  svg.append("g")
			      .attr("class", "axis linechart")
			      .attr("transform", "translate(80," + newHeight + ")")
			      .append("text")
					  .attr("class", "label")
					  .attr("x", 310)
					  .attr("y", 50)
					  .style("text-anchor", "end")
					  .text("CHINA’S HONGMU IMPORTS BY CONTINENT");
					  
			  svg.append("g")
			      .attr("class", "y axis linechart")
			      .attr("transform", "translate(80,0)")
			      .call(yAxis)
			      .append("text")
					  .attr("class", "label")
					  .attr("transform", "rotate(-90)")
					  .attr("x", -50)
					  .attr("y", 12)
					  .style("text-anchor", "end")
					  .text("cubic meters");

			  svg.append("line")
			        .attr(
			        {
			            "class":"horizontalGrid",
			            "x1" : 80,
			            "x2" : newWidth+80,
			            "y1" : y(0),
			            "y2" : y(0),
			            "fill" : "none",
			            "shape-rendering" : "crispEdges",
			            "stroke" : "black",
			            "stroke-width" : "1px"
			        });
			
			
			  var continent = svg.selectAll(".continent")
			      .data(continents)
			    .enter().append("g")
			      .attr("class", "continent");
			
			
			
			  var path = svg.selectAll(".continent").append("path")
			      .attr("class", "line")
			      .attr("transform", "translate(80,0)")
			      .attr("d", function(d) { return line(d.values); })
			      .style("stroke", function(d) { if (d.name == "All") 
			                                        {return "#b2182b"}
			                                     else if(d.name == "Africa"){return "#ef8a62"}
			                                     else if(d.name == "Asia"){return "#2166ac"}
			                                     else if(d.name == "LatinAmerica"){return "#67a9cf"}
			                                     else{return "#fddbc7";}
			                                         });
	  		/* animate lines*/
	  		
	  		var totalLength = [path[0][0].getTotalLength(), path[0][1].getTotalLength(),path[0][2].getTotalLength(),path[0][3].getTotalLength(),path[0][4].getTotalLength()];
	
			// console.log(totalLength);
			
			
			   d3.select(path[0][0])
			      .attr("stroke-dasharray", totalLength[0] + " " + totalLength[0] ) 
			      .attr("stroke-dashoffset", totalLength[0])
			      .transition()
			        .duration(3000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			
			   d3.select(path[0][1])
			      .attr("stroke-dasharray", totalLength[1] + " " + totalLength[1] )
			      .attr("stroke-dashoffset", totalLength[1])
			      .transition()
			        .duration(3000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			   
			   d3.select(path[0][2])
			      .attr("stroke-dasharray", totalLength[2] + " " + totalLength[2] )
			      .attr("stroke-dashoffset", totalLength[2])
			      .transition()
			        .duration(3000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			  
			  d3.select(path[0][3])
			      .attr("stroke-dasharray", totalLength[3] + " " + totalLength[3] )
			      .attr("stroke-dashoffset", totalLength[3])
			      .transition()
			        .duration(3000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);
			  
			  d3.select(path[0][4])
			      .attr("stroke-dasharray", totalLength[4] + " " + totalLength[4] )
			      .attr("stroke-dashoffset", totalLength[4])
			      .transition()
			        .duration(3000)
			        .ease("linear")
			        .attr("stroke-dashoffset", 0);

			        
		
		});

}//end createLine




function createWorldMap(svg){

var projection = d3.geo.mercator()
  .scale(150)
  .center([20, 40])
  .translate([width / 2, height / 2]);

 var path= d3.geo.path()
  .projection(projection);

 var features = countries2.features;   
 
 d3.csv("data/sum_by_country.csv", function(error, data) {
		
		data.sort(function(a,b){
            	return a.value - b.value;
          });
          
		var myfeatures= joinData(features, data, ['value']);
		
		
		var worldMap = svg.append('g');
		var world = worldMap.selectAll(".worldcountries")
	            .data(myfeatures)
	            .enter()
	            .append("path")
	            .attr("class", function(d){
	                return "World " + d.properties.name+" worldcountries";
	            })
	            .attr("d", path)
	            .style("fill", "#ddd")
		      .style("stroke", "white")
	          .style("stroke-width", "1")
	          .style("opacity",0);
	          
	    var max = d3.max(data, function(d) { return d.value; })
		var min = d3.min(data, function(d) { return d.value; })
		
		var radius =  d3.scale.sqrt()
				.domain([0,1097805])
				.range([3, 20]);
				
		var newFeatures = [];
		myfeatures.forEach(function(d){
			//console.log(d.properties.name);
			if(d.properties.hasOwnProperty("value")){
				//console.log(d.properties.name);
				newFeatures.push(d);
			}
			
		});
		
		
		newFeatures.sort(function(a,b){
            	return b.properties.value - a.properties.value;
          });

	 	//console.log(newFeatures);
		 
		// console.log(newFeatures);
		var bubbles = svg.append("g").classed("bubbleG","true");
    	
    	bubbles.selectAll("circle")
    		.data(newFeatures)
  			.enter().append("circle")
  			.attr("class", "bubble")
    		.attr("transform", function(d) { 
    			return "translate(" + path.centroid(d) + ")"; 
    		})
   			.attr("r", function(d){
   				return radius(d.properties.value);
   			})
   			.attr("fill","#2166ac")
   			.attr("stroke","white")
   			.attr("id", function(d){
   				return "circle "+d.properties.name;
   			})
   			.style("opacity",0);
   			

   		     mapBarTransition(newFeatures);
});

}

var bubbleMapState = 'map'; // map or bar

	// button onclick
	function mapBarTransition(data){


	var margin = {top:20, right:20, bottom:150, left:80},
			chartW = width - margin.left - margin.right,
			chartH = height - margin.top - margin.bottom;
			

			var x = d3.scale.ordinal()
					.domain(data.map(function(d) { return d.properties.name; }))
					.rangeBands([0, chartW], .3);
			
			// var y = d3.scale.linear()
// 					.domain([0,1097805])
// 					
// 					.range([chartH,0]);

			var y = d3.scale.log()
					.range([chartH,0])
					.domain([1,1097805]);
					

			var xAxis = d3.svg.axis()
						.scale(x)
						.orient("bottom");

			var yAxis = d3.svg.axis()
						.scale(y)
						.ticks(8)
						.tickFormat(function (d) {
								return y.tickFormat(4,d3.format(",d"))(d)
						})
						.orient("left");
			
			var barW = width / data.length;
			 
			 
			 //if barsG
			 
			 var barsG = svg.append("g").classed("barG","true");
			 barsG.attr({transform: "translate(" + margin.left + "," + margin.top + ")"});
			
					barsG.append("g").classed("bubblebar-chart-group", true);
					barsG.append("g").classed("bubblebar-x-axis-group axis", true);
					barsG.append("g").classed("bubblebar-y-axis-group axis", true);

				

				barsG.select(".bubblebar-x-axis-group.axis")
					.attr({transform: "translate(0," + (chartH) + ")"})
					.call(xAxis)
					.style('opacity',0)
					.selectAll("text")	
					.style('font-size','12px')
					.style("text-anchor", "end")
					.attr("dx", "-0.40em")
					.attr("dy", ".10em")
					.attr("transform", function(d) {
						return "rotate(-65)" 
						})
					  .style('opacity',0);
					
					
					// .attr("dx", "-.8em")
// 					.attr("dy", ".15em")
// 					.attr("transform", function(d) {
// 						return "rotate(-65)" 
// 						})

				barsG.select(".bubblebar-y-axis-group.axis")
					.call(yAxis)
					.style('opacity',0);
			
			
				barW = x.rangeBand();

				var bars = barsG.select(".bubblebar-chart-group")
						.selectAll(".bubblebar")
						.data(data);
					
				bars.enter().append("rect")
					.classed("bubblebar", true)
					.attr("x", function(d) { return x(d.properties.name); })
					.attr("y", function(d) { return y(d.properties.value); })
					.attr("width", barW)
					.attr("height", function(d) { return chartH - y(d.properties.value); })
					.attr("fill","#2166ac")
					.style('opacity',0);
			   
				
				barsG.select(".bubblebar-x-axis-group.axis").append("g")
			      .attr("class", "barxlabelG")
			      .append("text")
					  .attr("class", "barxlabel")
					  .attr("x", 0)
					  .attr("y", 120)
					  .text("Hongmu Export by Volume 2009-2017, cubic meters")
					  .style('font-size','20px');
					  
			 
				
				

			// 
// 				bars.exit().transition().style({opacity: 0}).remove();


	}
	
	
	
	
	function clicked(){
			if(bubbleMapState=='map'){
				$("#bubblebar").text("See Map");
				bubbleMapState ='bar';
				d3.selectAll(".bubblebar")
				.transition()
				.duration(1000)
				.style("opacity",1);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(1000)
					.style('opacity',1);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(1000)
					.style('opacity',1);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(1000)
					.style('opacity',1);
					
				d3.selectAll(".worldcountries")
					.transition()
					.duration(1000)
					.style('opacity',0);
					
				d3.selectAll(".bubble")
				.transition()
					.duration(1000)
					.style('opacity',0);

 				
			}else{
				bubbleMapState ='map';
				$("#bubblebar").text("See Bar Chart");
				d3.selectAll(".bubblebar")
				.transition()
				.duration(1000)
				.style("opacity",0);
				
				d3.selectAll(".bubblebar-y-axis-group.axis")
					.transition()
					.duration(1000)
					.style('opacity',0);
					
				d3.selectAll(".bubblebar-x-axis-group.axis")
				.transition()
					.duration(1000)
					.style('opacity',0);
				d3.selectAll(".bubblebar-x-axis-group.axis text")
				.transition()
					.duration(1000)
					.style('opacity',0);
					
				d3.selectAll(".worldcountries")
					.transition()
					.duration(1000)
					.style('opacity',1);
					
				d3.selectAll(".bubble")
				.transition()
					.duration(1000)
					.style('opacity',0.7);
			};	

	}
	


function createChinaMap(svg){
    
var projection = d3.geo.mercator()
  .scale(500)
  // Center the Map in Colombia
  .center([105, 35])
  .translate([width / 2, height / 2]);

 var path= d3.geo.path()
  .projection(projection);


 var features = countries.features;   
 
 var china_vietnam = features.filter(function(d){
 	return d.properties.name == 'China' || d.properties.name == 'Vietnam';
 })
 
 console.log(china_vietnam);
 	 
 
 var mapLayer = svg.append('g');
 
 mapLayer.selectAll("path")
	.data(china_vietnam)
	.enter()
	.append("path")
	.attr("d", path)
	.attr("class","china")
	.style("stroke", "white")
	.style("stroke-width", "1")
	.style("fill", "#2166ac")
	.style("opacity", 0);
	
	
var background_countries_china = features.filter(function(d){
	 	return  d.properties.name == 'Mongolia' || d.properties.name == 'India' || d.properties.name == 'Thailand' || d.properties.name == 'Nepal' || d.properties.name == 'Taiwan' || d.properties.name == 'Myanmar' || d.properties.name == 'Bhutan' || d.properties.name == 'Bangladesh' || d.properties.name == 'Laos' || d.properties.name == 'Cambodia' || d.properties.name == 'Indonesia' || d.properties.name == 'Thailand' || d.properties.name == 'Philippines' 
	 	|| d.properties.name == 'Kazakhstan' || d.properties.name == 'Russia' || d.properties.name == 'North Korea' || d.properties.name == 'South Korea' || d.properties.name =='Kyrgyzstan' || d.properties.name =='Tajikistan' || d.properties.name =='Afghanistan' || d.properties.name =='Turkmenistan' || d.properties.name =='Pakistan' || d.properties.name =='Uzbekistan' || d.properties.name =='Japan' || d.properties.name =='Malaysia' || d.properties.name =='Iran';
	 });
	 
	var bg_china = svg.append('g');
	var bgCountries = bg_china.selectAll(".bgcountrieschina")
	            .data(background_countries_china)
	            .enter()
	            .append("path")
	            .attr("class", "bgcountrieschina")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#eaeaea")
	            .style("opacity", 0);
	

} //end createChinaMap 
    



function createAfricaMap(svg){
	var DataArray = ["2009","2010","2011","2012","2013","2014","2015","2016","2017"];
	var expressed = DataArray[0];
	var attributeIndex = 0;
	
	var projection = d3.geo.mercator()
	  .scale(1200)
	  // Center the Map in Colombia
	  .center([-3, 15])
	  .translate([width / 2, height / 2]);
	
	 var path = d3.geo.path()
	  .projection(projection);
	
	
	 var features = countries.features; 
	 
	 var west_africa = features.filter(function(d){
	 	return d.properties.name == 'Nigeria' || d.properties.name == 'Ghana' || d.properties.name == 'Gambia' || d.properties.name == 'Guinea-Bissau' || d.properties.name == 'Benin';
	 });
	 
	 var background_countries = features.filter(function(d){
	 	return d.properties.name == 'Burkina Faso' || d.properties.name == 'Ivory Coast' || d.properties.name == 'Liberia' || d.properties.name == 'Guinea' || d.properties.name == 'Togo' || d.properties.name == 'Senegal' || d.properties.name == 'Mali' || d.properties.name == 'Mauritania' || d.properties.name == 'Sierra Leone' || d.properties.name == 'Western Sahara' || d.properties.name == 'Morocco' || d.properties.name == 'Algeria' || d.properties.name == 'Niger' || d.properties.name == 'Nigeria' || d.properties.name == 'Chad' || d.properties.name == 'Cameroon' || d.properties.name == 'Equatorial Guinea' || d.properties.name == 'Gabon' || d.properties.name == 'Republic of the Congo' || d.properties.name == 'Libya' || d.properties.name == 'Central African Republic' || d.properties.name == 'Tunisia'; });
	
	var bg = svg.append('g');
	var bgCountries = bg.selectAll(".bgcountries")
	            .data(background_countries)
	            .enter()
	            .append("path")
	            .attr("class", "bgcountries")
	            .attr("d", path)
	            .style("stroke", "white")
	            .style("stroke-width", "1")
	            .style("fill", "#eaeaea")
	            .style("opacity",0);
	            

			
	
	d3.csv("data/africa_new.csv", function(error, data) {
		var myfeatures= joinData(west_africa, data, DataArray);
		
		var extent = [0,10000,50000,100000,200000,240000];
		var colorScale = makeColorScale(myfeatures,extent);
		
		var africaLegend = svg.append("g")
				  .attr("class", "legendMapAfrica")
				  .attr("transform", "translate(20,20)");

			var legend = d3.legend.color() 
			  .labelFormat(d3.format(".0f"))
			  // .labels(d3.legendHelpers.thresholdLabels)
			  .scale(colorScale);

			svg.select(".legendMapAfrica")
			  .call(legend)
			  .style('opacity',0);
		
		var africaMap = svg.append('g');
		var westAfricaCountries = africaMap.selectAll(".africancountries")
	            .data(myfeatures)
	            .enter()
	            .append("path")
	            .attr("class", function(d){
	                return "Africa " + d.properties.name+" africancountries";
	            })
	            .attr("d", path)
	            .style("fill", function(d) {
		          return choropleth(expressed, d.properties, colorScale);
		      })
		      .style("stroke", "white")
	          .style("stroke-width", "1")
		      .style("opacity",0);
		      
		     
		var labels = svg.append('g');
       
       labels.selectAll("text") 
           .data(west_africa) 
        	.enter().append("svg:text") 
        	.attr("class", "wafricatext")
             .text(function(d){return d.properties.name;}) 
             .attr("x", function(d){return path.centroid(d)[0];})
			.attr("y", function(d){return  path.centroid(d)[1];})
			.attr("text-anchor","middle")
			.style('opacity',0);
			
		var buttonIDForward = "#stepForwardAf";
		var buttonIDBackward = "#stepBackwardAf";
		var yearID = "#yearLabelAf";
		var thisclass = ".africancountries";
		
		var barsSvg = svg.append('g').attr('id','bars').style('opacity',0);
		barsSvg.attr("transform","translate("+(width-400)+",80)");
		chart = d3.custom.barChart();
		var selectedYear = '2009';
		chart.year(selectedYear);
		d3.select("#bars")
				.datum(data)
				.call(chart);
		      
	    	createSequenceControls(DataArray, attributeIndex, expressed, myfeatures, buttonIDForward, buttonIDBackward, yearID, thisclass,data,extent);
		
	});

}


function createSequenceControls(DataArray, attributeIndex, expressed, thisfeatures, buttonIDForward, buttonIDBackward, yearID, thisclass,data,extent){



      var yearLabel = d3.select(yearID)
        .text(expressed);

        $(buttonIDForward).on("click", function(){
            attributeIndex +=1
              if(attributeIndex > DataArray.length-1){
                attributeIndex = 0
              }

            expressed = DataArray[attributeIndex]

            d3.select(yearID)
              .text(expressed);
            
            if(thisclass == ".africancountries"){
            	AfricaYear = expressed;
            }
            
            if(thisclass == ".asiancountries"){
            	AsiaYear = expressed;
            }
            
            if(thisclass == ".latincountries"){
            	LatinYear = expressed;
            }
    
		chart.year(expressed);
		d3.select("#bars")
				.datum(data)
				.call(chart);
				
		chart2.year(expressed);
				d3.select("#bars2")
				.datum(data)
				.call(chart2);
				
		chart3.year(expressed);
				d3.select("#bars3")
				.datum(data)
				.call(chart3);
              

            changeAttribute(expressed, thisfeatures, thisclass,extent)
        })

        $(buttonIDBackward).on("click", function(){
            attributeIndex -=1

              if(attributeIndex < 0){
                attributeIndex = DataArray.length-1
              }

              expressed = DataArray[attributeIndex]

              d3.select(yearID)
                .text(expressed)
                
                if(thisclass == ".africancountries"){
            		AfricaYear = expressed;
				}
			
				if(thisclass == ".asiancountries"){
					AsiaYear = expressed;
				}
			
				if(thisclass == ".latincountries"){
					LatinYear = expressed;
				}
                
                chart.year(expressed);
				d3.select("#bars")
				.datum(data)
				.call(chart);
				
				chart2.year(expressed);
				d3.select("#bars2")
				.datum(data)
				.call(chart2);
				
				chart3.year(expressed);
				d3.select("#bars3")
				.datum(data)
				.call(chart3);

              changeAttribute(expressed, thisfeatures, thisclass,extent)
        })
}

//dropdown change listener handler
function changeAttribute(thisexpressed, thisfeatures, thisclass,extent){
	/* console.log("peeg"); */
    //recreate the color scale
    var colorScale = makeColorScale(thisfeatures,extent);

    //recolor enumeration units
    d3.selectAll(thisclass)
        .style("fill", function(d){
            return choropleth(thisexpressed, d.properties, colorScale)
        });
};


function makeColorScale(data,extent){
	
	
	
	var colorScale = d3.scale.threshold()
        .domain(extent)
        .range(['#fef0d9','#fdd49e','#fdbb84','#fc8d59','#e34a33','#b30000']);

    return colorScale;
};

function choropleth(expressed, props, colorScale){
    //make sure attribute value is a number

    var val = parseInt(props[expressed]);

    //if attribute value exists, assign a color; otherwise assign gray
    if (val){
        return colorScale(val);
    } else {
        return "#fef0d9";
    };
};


function joinData(thisFeatures, thisData, DataArray){


    //loop through csv to assign each set of csv attribute values to geojson counties
    for (var i=0; i<thisData.length; i++){
      var csvCountry = thisData[i]; //the current county
      var csvKey = csvCountry.Country; //the CSV primary key

      //loop through geojson regions to find correct counties
      for (var a=0; a<thisFeatures.length; a++){

          var geojsonProps = thisFeatures[a].properties; //the current region geojson properties
          var geojsonKey = geojsonProps.name; //the geojson primary key

          //where primary keys match, transfer csv data to geojson properties object
          if (geojsonKey == csvKey){
              //assign all attributes and values
              DataArray.forEach(function(attr){
                  var val = parseFloat(csvCountry[attr]); //get csv attribute value
                  geojsonProps[attr] = val; //assign attribute and value to geojson properties
              });
          };
      };
    };
    /* console.log(thisFeatures); */
    return thisFeatures;
};



	function createAsiaMap(svg){
		
		var DataArray = ["2009","2010","2011","2012","2013","2014","2015","2016","2017"];
		var expressed = DataArray[0];
		var attributeIndex = 0;
	
		var projection = d3.geo.mercator()
		  .scale(800)
		  .center([110, 10])
		  .translate([width / 2, height / 2]);
	
		 var path = d3.geo.path()
		  .projection(projection);
	
	
		 var features = countries.features; 
	 
		 var SE_Asia = features.filter(function(d){
			return d.properties.name == 'Laos' || d.properties.name == 'Myanmar' || d.properties.name == 'Vietnam' || d.properties.name == 'Indonesia' || d.properties.name == 'Cambodia' || d.properties.name == 'Thailand';
		 });
	 
		 var background_countries = features.filter(function(d){
			return  d.properties.name == 'China' || d.properties.name == 'India' || d.properties.name == 'Taiwan' || d.properties.name == 'Philippines' || d.properties.name == 'Malaysia' || d.properties.name == 'Nepal' || d.properties.name == 'Bhutan' || d.properties.name == 'Bangladesh' || d.properties.name == 'Japan';
		 });
	 
		 // console.log(SE_Asia);
	
		var bg = svg.append('g');
		var bgCountries = bg.selectAll(".bgcountries2")
					.data(background_countries)
					.enter()
					.append("path")
					.attr("class", "bgcountries2")
					.attr("d", path)
					.style("stroke", "white")
					.style("stroke-width", "1")
					.style("fill", "#eaeaea")
					.style("opacity",0);
					
		 d3.csv("data/asia_new.csv", function(error, data) {
			var myfeatures= joinData(SE_Asia, data, DataArray);
			var extent = [0,10000,50000,200000,400000,450000];
			var colorScale = makeColorScale(myfeatures,extent);
			
			var asiaLegend = svg.append("g")
				  .attr("class", "legendMapAsia")
				  .attr("transform", "translate(20,20)");

			var legend = d3.legend.color() 
			  .labelFormat(d3.format(".0f"))
			  // .labels(d3.legendHelpers.thresholdLabels)
			  .scale(colorScale);

			svg.select(".legendMapAsia")
			  .call(legend)
			  .style('opacity',0);
		
			var asiaMap = svg.append('g');
		
		
			 var SE_AsiaCountries = asiaMap.selectAll(".asiancountries")
					.data(myfeatures)
					.enter()
					.append("path")
					.attr("class", function(d){
						return "Asia " + d.properties.name+" asiancountries";
					})
					.attr("d", path)
					.style("fill", function(d) {
					  return choropleth(expressed, d.properties, colorScale);
				    })
				  .style("stroke", "white")
				  .style("stroke-width", "1")
				  .style("opacity",0);
					

			  var labels = svg.append('g');
	   
		   labels.selectAll("text") 
			   .data(SE_Asia) 
				.enter().append("svg:text") 
				.attr("class", "seasiatext")
				 .text(function(d){return d.properties.name;}) 
				 .attr("x", function(d){return path.centroid(d)[0];})
				.attr("y", function(d){return  path.centroid(d)[1];})
				.attr("text-anchor","middle")
				.style('opacity',0);
			  
				var buttonIDForward = "#stepForwardAs";
				var buttonIDBackward = "#stepBackwardAs";
				var yearID = "#yearLabelAs";
				var thisclass = ".asiancountries";
				
				var barsSvg = svg.append('g').attr('id','bars2').style("opacity",0);
				barsSvg.attr("transform","translate("+(width-400)+",20)");
				chart2 = d3.custom.barChart();
				var selectedYear = '2009';
				chart2.year(selectedYear);
				d3.select("#bars2")
						.datum(data)
						.call(chart2);
			
				createSequenceControls(DataArray, attributeIndex, expressed, myfeatures, buttonIDForward, buttonIDBackward, yearID, thisclass,data,extent);
		
		});
				
	}  
	



	function createAmericaMap(svg){

		var DataArray = ["2009","2010","2011","2012","2013","2014","2015","2016","2017"];
		var expressed = DataArray[0];
		var attributeIndex = 0;
	
		var projection = d3.geo.mercator()
		  .scale(1000)
		  .center([-98, 20])
		  .translate([width / 2, height / 2]);
	
		 var path = d3.geo.path()
		  .projection(projection);
	
	
		 var features = countries.features; 
	 
		 var LatinAmerica = features.filter(function(d){
			return d.properties.name == 'Nicaragua' || d.properties.name == 'Belize' || d.properties.name == 'Mexico' || d.properties.name == 'Panama' || d.properties.name == 'Guatemala' || d.properties.name == 'Honduras';
		 });
	 
		 var background_countries = features.filter(function(d){
			return  d.properties.name == 'Costa Rica' || d.properties.name == 'El Salvador' || d.properties.name == 'Colombia' || d.properties.name == 'Venezuela' || d.properties.name == 'Ecuador' || d.properties.name == 'United States' || d.properties.name == 'Peru' || d.properties.name == 'Brazil';
		 });
	 
		 //console.log(LatinAmerica);
	 
		 var bg = svg.append('g');
		 var bgCountries = bg.selectAll(".bgcountries3")
					.data(background_countries)
					.enter()
					.append("path")
					.attr("class", "bgcountries3")
					.attr("d", path)
					.style("stroke", "white")
					.style("stroke-width", "1")
					.style("fill", "#eaeaea")
					.style("opacity", 0);
	 
		 d3.csv("data/latin_new.csv", function(error, data) {
			var myfeatures= joinData(LatinAmerica, data, DataArray);
		    var extent = [0,1000,5000,10000,50000,60000];
			var colorScale = makeColorScale(myfeatures, extent);
			
			var africaLegend = svg.append("g")
				  .attr("class", "legendMapLatin")
				  .attr("transform", "translate(20,20)");

			var legend = d3.legend.color() 
			  .labelFormat(d3.format(".0f"))
			  // .labels(d3.legendHelpers.thresholdLabels)
			  .scale(colorScale);

			svg.select(".legendMapLatin")
			  .call(legend)
			  .style('opacity',0);
		
			var latinMap = svg.append('g');
		
			 var LatinCountries = latinMap.selectAll(".latincountries")
					.data(myfeatures)
					.enter()
					.append("path")
					.attr("class", function(d){
						return "Latin " + d.properties.name+" latincountries";
					})
					.attr("d", path)
					.style("fill", function(d) {
					  return choropleth(expressed, d.properties, colorScale);
				  })
				  .style("stroke", "white")
				  .style("stroke-width", "1")
				  .style("opacity",0);
		
	
			 var labels = svg.append('g');
	   
		   labels.selectAll("text") 
				 .data(LatinAmerica) 
				 .enter().append("svg:text") 
				 .attr("class", "latinamericatext")
				 .text(function(d){return d.properties.name;}) 
				 .attr("x", function(d){return path.centroid(d)[0];})
				 .attr("y", function(d){return  path.centroid(d)[1];})
				 .attr("text-anchor","middle")
				 .style('opacity',0);
			  
				var buttonIDForward = "#stepForwardLa";
				var buttonIDBackward = "#stepBackwardLa";
				var yearID = "#yearLabelLa";
				var thisclass = ".latincountries";
				
				
				var barsSvg = svg.append('g').attr('id','bars3').style("opacity",0);
				barsSvg.attr("transform","translate("+(width-400)+",20)");
				chart3 = d3.custom.barChart();
				var selectedYear = '2009';
				chart3.year(selectedYear);
				d3.select("#bars3")
						.datum(data)
						.call(chart3);
			
				createSequenceControls(DataArray, attributeIndex, expressed, myfeatures, buttonIDForward, buttonIDBackward, yearID, thisclass,data,extent);
		
		});
	

	} 
} 

       
         
    
  </script>
</body>
